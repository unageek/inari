<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
></script>
<script>
  (function () {
    "use strict";

    // TODO: Bring \DeclarePairedDelimiter?
    //   https://github.com/mathjax/MathJax/issues/2313
    window.MathJax = {
      tex: {
        inlineMath: [["$", "$"]],
        displayMath: [["$$", "$$"]],
        macros: {
          addend: "\\mathtt{addend}",
          bin: "\\vphantom{0}_2",
          e: "\\mathrm{e}",
          if: "\\text{if }",
          nextDown: "\\operatorname{\\mathtt{nextDown}}",
          nextOut: "\\operatorname{\\mathtt{nextOut}}",
          nextUp: "\\operatorname{\\mathtt{nextUp}}",
          otherwise: "\\text{otherwise}",
          rhs: "\\mathtt{rhs}",
          self: "\\mathtt{self}",
          sgn: "\\operatorname{sgn}",
          RD: "\\operatorname{\\raise{.4ex}{â–½}_\\F}",
          RDU: "\\operatorname{â—Š_\\IF}",
          RU: "\\operatorname{â–³_\\F}",
          // Sets
          D: "ð”»",
          DIF: "{ð”»ð•€ð”½}",
          DIR: "{ð”»ð•€\\overline{â„}}\\vphantom{ð•}",
          F: "ð”½",
          IF: "{ð•€ð”½}\\vphantom{ð•}",
          IR: "{ð•€\\overline{â„}}\\vphantom{ð•}",
          N: "â„•",
          R: "â„",
          XR: "{\\overline{â„}}\\vphantom{ð•}",
          // Decorations
          com: "\\mathtt{com}",
          dac: "\\mathtt{dac}",
          def: "\\mathtt{def}",
          trv: "\\mathtt{trv}",
          ill: "\\mathtt{ill}",
        },
      },
      options: {
        renderActions: {
          preprocess: [
            10, // MathJax._.core.MathItem.STATE.FINDMATH
            (doc) => {
              for (const math of doc.math) {
                preprocess(math);
              }
            },
            (math, doc) => {
              preprocess(math);
            },
          ],
        },
      },
    };

    // NOTE: This does not work for surrogate pairs nor combining character sequences.
    const charSubstitutions = {
      Ï€: "ðœ‹",
      "âˆ§": "\\mathrel{âˆ§}", // logical AND
      "âˆ¨": "\\mathrel{âˆ¨}", // logical OR
      "Ã—": "\\times",
    };

    function preprocess(math) {
      math.math = math.math.replace(/./g, (ch) => {
        return charSubstitutions[ch] || ch;
      });
    }
  })();
</script>
